extends Node


# Declare member variables here:
var level = 1
var highest_reached_level = 1
var wall_type = 0
var data = {"level" : level, "highest_reached_level" : highest_reached_level, "wall_type" : wall_type}
var file = File.new()
var is_save_file_loaded = false

var pushes = 0
var boxes = 0
var on_target = 0
var pushes_player = []
var pushes_boxes = []

const MAPS = [
	[],
	[
		[
			[0, 0, 1, 1, 1],
			[0, 0, 1, 2, 1],
			[1, 1, 1, 0, 1, 1, 1],
			[1, 2, 0, 0, 0, 2, 1],
			[1, 1, 1, 0, 1, 1, 1],
			[0, 0, 1, 2, 1],
			[0, 0, 1, 1, 1]
		]
	],
	[
		[
			[0, 0, 0, 0, 0, 0, 1, 1, 1],
			[0, 0, 0, 0, 0, 0, 1, 2, 1],
			[0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1],
			[0, 0, 0, 0, 1, 2, 0, 0, 0, 2, 1],
			[0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1],
			[0, 0, 1, 2, 1, 2, 1, 0, 1, 2, 1, 2, 1],
			[1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1],
			[1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1],
			[1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1],
			[0, 0, 1, 2, 1, 2, 1, 0, 1, 2, 1, 2, 1],
			[0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1],
			[0, 0, 0, 0, 1, 2, 0, 0, 0, 2, 1],
			[0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1],
			[0, 0, 0, 0, 0, 0, 1, 2, 1],
			[0, 0, 0, 0, 0, 0, 1, 1, 1]
		]
	],
	[
		[
			[0, 0, 0, 1, 1, 1, 1, 1, 1, 1],
			[1, 1, 1, 1, 0, 0, 0, 0, 0, 1],
			[1, 0, 0, 0, 2, 1, 1, 1, 0, 1],
			[1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1],
			[1, 0, 1, 0, 0, 0, 0, 1, 2, 0, 1],
			[1, 0, 1, 0, 0, 2, 0, 0, 1, 0, 1],
			[1, 0, 2, 1, 0, 0, 0, 0, 1, 0, 1],
			[1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1],
			[0, 1, 0, 1, 1, 1, 2, 0, 0, 0, 0, 0, 1],
			[0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1],
			[0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
		]
	],
	[
		[
			[0, 0, 0, 0, 1, 1, 1, 1, 1],
			[0, 0, 0, 0, 1, 0, 0, 0, 1],
			[0, 0, 0, 0, 1, 0, 0, 0, 1],
			[0, 0, 1, 1, 1, 0, 0, 0, 1, 1],
			[0, 0, 1, 0, 0, 0, 0, 0, 0, 1],
			[1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0 ,1, 1, 1, 1, 1, 1],
			[1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 2, 2, 1],
			[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 1],
			[1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 2, 2, 1],
			[0, 0, 0, 0, 1, 0, 0, 8, 8, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1],
			[0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1]
		]
	],
	[
		[
			[0, 0, 0, 0, 0, 0, 1, 1, 1],
			[0, 0, 0, 0, 0, 1, 1, 0, 1, 1],
			[0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1],
			[0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1],
			[0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1],
			[0, 1, 1, 0, 0, 2, 0, 0, 0, 2, 0, 0, 1 ,1],
			[1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1],
			[1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 1],
			[1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1],
			[0, 1, 0, 0, 0, 2, 0, 8, 8, 2, 0, 0, 0, 1],
			[0, 1, 1, 0, 0, 0, 2, 2, 2, 0, 0, 0, 1, 1],
			[0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
			[0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1],
			[0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1],
			[0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1],
			[0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],
			[0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1],
			[0, 0, 0, 0, 0, 1, 0, 0, 0, 1],
			[0, 0, 0, 0, 0, 1, 1, 0, 1, 1],
			[0, 0, 0, 0, 0, 0, 1, 1, 1]
		]
	],
	[
		[
			[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
			[1, 2, 2, 2, 1, 0, 0, 1, 1, 0, 0, 1, 2, 2, 2, 1],
			[1, 2, 2, 2, 0, 0, 0, 1, 1, 0, 0, 0, 2, 2, 2, 1],
			[1, 2, 2, 2, 0, 0, 0, 1, 1, 0, 0, 0, 2, 2, 2, 1],
			[1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1],
			[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1],
			[1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1],
			[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1],
			[1, 2, 2, 2, 0, 0, 0, 1, 1, 0, 0, 0, 2, 2, 2, 1],
			[1, 2, 2, 2, 0, 0, 0, 1, 1, 0, 0, 0, 2, 2, 2, 1],
			[1, 2, 2, 2, 1, 0, 0, 1, 1, 0, 0, 1, 2, 2, 2, 1],
			[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
		]
	],
	[
		[
			[1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1],
			[1, 0, 0, 0, 0, 0, 1, 0, 1, 2, 2, 1, 0, 1, 0, 0, 0, 0, 0, 1],
			[1, 0, 0, 0, 0, 0, 1, 1, 1, 2, 2, 1, 1, 1, 0, 0, 0, 0, 0, 1],
			[1, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0, 0, 1],
			[1, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0, 0, 1],
			[1, 0, 0, 1, 1, 1, 1, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 1],
			[1, 0, 0, 1, 0, 0, 0, 0, 1, 2, 2, 1, 0, 0, 0, 0, 1, 0, 0, 1],
			[1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
			[1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1],
			[1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1],
			[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
		]
	],
	[
		[
			[0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
			[0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1],
			[0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1],
			[0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1],
			[1, 2, 2, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 2, 2, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1],
			[0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1],
			[0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1],
			[0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1],
			[0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1]
		]
	],
	[
		[
			[0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
			[0, 0, 0, 0, 1, 1, 1, 0, 2, 2, 0, 1, 1, 1],
			[0, 0, 1, 1, 1, 0, 0, 0, 2, 2, 0, 0, 0, 1, 1, 1],
			[1, 1, 1, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 1, 1, 1],
			[1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1],
			[1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1],
			[1, 0, 0, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 1],
			[1, 1, 0, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 1, 1],
			[0, 1, 1, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 1, 1],
			[0, 0, 1, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 1],
			[0, 0, 1, 1, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 1, 1],
			[0, 0, 0, 1, 1, 0, 0, 0, 2, 2, 0, 0, 0, 1, 1],
			[0, 0, 0, 0, 1, 0, 0, 0, 2, 2, 0, 0, 0, 1],
			[0, 0, 0, 0, 1, 1, 0, 0, 2, 2, 0, 0, 1, 1],
			[0, 0, 0, 0, 0, 1, 1, 0, 2, 2, 0, 1, 1],
			[0, 0, 0, 0, 0, 0, 1, 0, 2, 2, 0, 1],
			[0, 0, 0, 0, 0, 0, 1, 1, 2, 2, 1, 1],
			[0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1]
		]
	]
]
const BOX_POSITIONS = [
	[],
	[
		Vector3(2, 0, 3),
		Vector3(3, 0, 2),
		Vector3(3, 0, 4),
		Vector3(4, 0, 3)
	],
	[
		Vector3(3, 0, 6),
		Vector3(3, 0, 8),
		Vector3(5, 0, 5),
		Vector3(5, 0, 9),
		Vector3(6, 0, 3),
		Vector3(6, 0, 7),
		Vector3(6, 0, 11),
		Vector3(7, 0, 6),
		Vector3(7, 0, 8),
		Vector3(8, 0, 3),
		Vector3(8, 0, 7),
		Vector3(8, 0, 11),
		Vector3(9, 0, 5),
		Vector3(9, 0, 9),
		Vector3(11, 0, 6),
		Vector3(11, 0, 8)
	],
	[
		Vector3(4, 0, 4),
		Vector3(4, 0, 6),
		Vector3(5, 0, 5),
		Vector3(6, 0, 4),
		Vector3(6, 0, 6)
	],
	[
		Vector3(2, 0, 7),
		Vector3(5, 0, 2),
		Vector3(5, 0, 4),
		Vector3(5, 0, 7),
		Vector3(7, 0, 3),
		Vector3(7, 0, 4)
	],
	[
		Vector3(3, 0, 7),
		Vector3(6, 0, 4),
		Vector3(6, 0, 12),
		Vector3(7, 0, 14),
		Vector3(7, 0, 16),
		Vector3(8, 0, 4),
		Vector3(8, 0, 12),
		Vector3(11, 0, 7)
	],
	[
		Vector3(2, 0, 5),
		Vector3(2, 0, 10),
		Vector3(3, 0, 5),
		Vector3(3, 0, 10),
		Vector3(4, 0, 5),
		Vector3(4, 0, 10),
		Vector3(5, 0, 2),
		Vector3(5, 0, 3),
		Vector3(5, 0, 4),
		Vector3(5, 0, 5),
		Vector3(5, 0, 10),
		Vector3(5, 0, 11),
		Vector3(5, 0, 12),
		Vector3(5, 0, 13),
		Vector3(6, 0, 7),
		Vector3(6, 0, 9),
		Vector3(7, 0, 6),
		Vector3(7, 0, 8),
		Vector3(8, 0, 7),
		Vector3(8, 0, 9),
		Vector3(9, 0, 6),
		Vector3(9, 0, 8),
		Vector3(10, 0, 2),
		Vector3(10, 0, 3),
		Vector3(10, 0, 4),
		Vector3(10, 0, 5),
		Vector3(10, 0, 10),
		Vector3(10, 0, 11),
		Vector3(10, 0, 12),
		Vector3(10, 0, 13),
		Vector3(11, 0, 5),
		Vector3(11, 0, 10),
		Vector3(12, 0, 5),
		Vector3(12, 0, 10),
		Vector3(13, 0, 5),
		Vector3(13, 0, 10)
	],
	[
		Vector3(2, 0, 2),
		Vector3(2, 0, 4),
		Vector3(2, 0, 6),
		Vector3(2, 0, 8),
		Vector3(3, 0, 2),
		Vector3(3, 0, 3),
		Vector3(3, 0, 4),
		Vector3(5, 0, 7),
		Vector3(6, 0, 7),
		Vector3(7, 0, 9),
		Vector3(12, 0, 9),
		Vector3(13, 0, 7),
		Vector3(14, 0, 7),
		Vector3(16, 0, 2),
		Vector3(16, 0, 3),
		Vector3(16, 0, 4),
		Vector3(17, 0, 2),
		Vector3(17, 0, 4),
		Vector3(17, 0, 6),
		Vector3(17, 0, 8)
	],
	[
		Vector3(9, 0, 6),
		Vector3(9, 0, 7),
		Vector3(11, 0, 3),
		Vector3(11, 0, 5),
		Vector3(11, 0, 8),
		Vector3(11, 0, 10),
		Vector3(13, 0, 6),
		Vector3(13, 0, 7),
		Vector3(14, 0, 2),
		Vector3(14, 0, 11),
		Vector3(15, 0, 5),
		Vector3(15, 0, 8)
	],
	[
		Vector3(1, 0, 4),
		Vector3(2, 0, 4),
		Vector3(2, 0, 6),
		Vector3(3, 0, 4),
		Vector3(3, 0, 6),
		Vector3(3, 0, 8),
		Vector3(4, 0, 4),
		Vector3(4, 0, 6),
		Vector3(4, 0, 9),
		Vector3(5, 0, 4),
		Vector3(5, 0, 6),
		Vector3(5, 0, 8),
		Vector3(5, 0, 10),
		Vector3(6, 0, 4),
		Vector3(6, 0, 6),
		Vector3(7, 0, 4),
		Vector3(7, 0, 6),
		Vector3(7, 0, 7),
		Vector3(7, 0, 8),
		Vector3(7, 0, 9),
		Vector3(7, 0, 10),
		Vector3(7, 0, 11),
		Vector3(8, 0, 1),
		Vector3(8, 0, 2),
		Vector3(8, 0, 3),
		Vector3(8, 0, 4),
		Vector3(8, 0, 13),
		Vector3(8, 0, 14),
		Vector3(8, 0, 15),
		Vector3(8, 0, 16),
		Vector3(9, 0, 1),
		Vector3(9, 0, 2),
		Vector3(9, 0, 3),
		Vector3(9, 0, 4),
		Vector3(9, 0, 13),
		Vector3(9, 0, 14),
		Vector3(9, 0, 15),
		Vector3(9, 0, 16),
		Vector3(10, 0, 4),
		Vector3(10, 0, 6),
		Vector3(10, 0, 7),
		Vector3(10, 0, 8),
		Vector3(10, 0, 9),
		Vector3(10, 0, 10),
		Vector3(10, 0, 11),
		Vector3(11, 0, 4),
		Vector3(11, 0, 6),
		Vector3(12, 0, 4),
		Vector3(12, 0, 6),
		Vector3(12, 0, 8),
		Vector3(12, 0, 10),
		Vector3(13, 0, 4),
		Vector3(13, 0, 6),
		Vector3(13, 0, 9),
		Vector3(14, 0, 4),
		Vector3(14, 0, 6),
		Vector3(14, 0, 8),
		Vector3(15, 0, 4),
		Vector3(15, 0, 6),
		Vector3(16, 0, 4)
	]
]
const PLAYER_POSITIONS = [
	[],
	Vector3(3, 0, 3),
	Vector3(7, 0, 7),
	Vector3(10, 0, 8),
	Vector3(11, 0, 8),
	Vector3(7, 0, 7),
	Vector3(8, 0, 8),
	Vector3(9, 0, 10),
	Vector3(16, 0, 6),
	Vector3(7, 0, 15)
]
